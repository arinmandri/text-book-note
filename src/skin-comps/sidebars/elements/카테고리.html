{% extends "skin-comps/sidebars/elements/base.html" %}
{% block mainOpen %}<nav id="navCat" class="sidebar_elementMain">{% endblock %}
{% block main %}[##_category_list_##]{% endblock %}
{% block mainClose %}
</nav>
{% endblock %}
{% block script %}
<script type="text/javascript">

  (function () {
    const sup_lis = document.querySelectorAll('#navCat .category_list > li');
    for (let sup_li of sup_lis) {

      //// 각 상위 카테고리 하위 첫 아이템으로 전체보기 추가
      let sub_ul = sup_li.querySelector('ul.sub_category_list');
      if( sub_ul == null ){// 하위 카테고리 없음
        sub_ul = document.createElement('ul');
        sub_ul.classList.add('sub_category_list');
        sup_li.append( sub_ul );
      }
      const sup_a = sup_li.getElementsByTagName('a')[0];// 원래 상위카테 a 태그: 새 하위 li(전체보기)로 이동.
      const sup_newSpan = document.createElement('span');// 원래 상위카테 a 태그를 대신함.
      sup_newSpan.classList.add('newA');
      sup_newSpan.textContent = sup_a.childNodes[0].textContent;
      sup_li.prepend( sup_newSpan );
      
      const allLi = document.createElement('li');
      sup_a.childNodes[0].textContent = ' 전체보기 ';
      allLi.append( sup_a );
      sub_ul.prepend( allLi );

      //// 각 상위 카테고리 누르면 여닫상태(하위 카테고리 보이기) 토글
      sup_newSpan.addEventListener('click', () => {
        sup_li.classList.toggle('open');
      });
    }
  })();

  document.addEventListener('DOMContentLoaded', function(){
    //// 카테고리 기본으로 펴기
    const category_list_list = document.querySelectorAll('#navCat .category_list > li');
    const catOpenLevel = '[##_var_catOpenLevel_##]';
    if( catOpenLevel === 'openAll' ){// 모두 열기
      for( let li of category_list_list ){
        li.classList.add('open');
      }
    }else if( catOpenLevel === 'openCurr' ){
      const currCat = (function(){
        if( window.location.pathname.startsWith('/category/') ){// 카테고리 페이지
          return window.location.pathname.substring(10).split('/')[0];// 10: '/category/' 글자수
        }else{
          let catBtn = document.querySelector('#postPagePost .func .category');
          if( catBtn != null ){
            return encodeURIComponent( catBtn.innerText.split('/')[0] );
          }
        }
        return null;
      })();
      if( currCat !== null ){
        const pathname = '/category/' + currCat;
        for( let li of category_list_list ){
          if( li.getElementsByTagName('a')[0].getAttribute('href') === pathname ){
            li.classList.add('open');
            break;
          }
        }
      }
    }
  });
</script>
{% endblock %}