
<s_tag><!--◆ 태그 페이지 -->
  <link rel="stylesheet" type='text/css' href="./images/style_tag.css">

  <h2 class="pageTitle">태그 <span id="tagCount"></span></h2>
  <ul id="tagBox">
    <s_tag_rep><li><a href="[##_tag_link_##]" class="tagcloud tag[##_tag_class_##]">[##_tag_name_##]</a></li> </s_tag_rep>
  </ul>

  <hr class="areaSeparator">

  <h2 class="pageTitle">가나다순</h2>
  <div id="main4" class="tagBoxOrdered"></div>

  <script type="text/javascript">
    //// 한글 초성
    const Chosong = ['ㄱ', 'ㄲ', 'ㄴ', 'ㄷ', 'ㄸ', 'ㄹ', 'ㅁ', 'ㅂ', 'ㅃ', 'ㅅ', 'ㅆ', 'ㅇ', 'ㅈ', 'ㅉ', 'ㅊ', 'ㅋ', 'ㅌ', 'ㅍ', 'ㅎ'];

    const tagBox        = document.getElementById('tagBox');
    const tagBoxOrdered = document.getElementById('main4');
    const items = Array.from(tagBox.children);// tagBox의 자식 요소를 배열로 수집
    const grouped = {};// 초성으로 분류

    items.forEach(el => {// 항목 분류
      const text = el.innerText.trim();
      if( text.length === 0) return;

      const key = getTextInitial(text[0]);// 분류기준: 초성
      if( !grouped[key] )
        grouped[key] = [];

      grouped[key].push( el.cloneNode(true) );// 노드 복사본 저장
    });

    const sortedKeys = Object.keys(grouped).sort((a, b) => {// 키 가나다순
      return a.localeCompare(b, 'ko-KR');
    });

    //// 결과 구성
    sortedKeys.forEach(key => {
      const bucket = document.createElement('div');
      bucket.className = 'bucket';

      const bucketName = document.createElement('h4');
      bucketName.className = 'bucketName';
      bucketName.innerText = key;
      bucketName.id = 'tag-initial--' + key;

      const list = document.createElement('ul');
      list.className = 'list';

      grouped[key].sort((a, b) => a.innerText.localeCompare(b.innerText, 'ko-KR'))
                    .forEach(clone => list.appendChild(clone));

      bucket.appendChild(bucketName);
      bucket.appendChild(list);
      tagBoxOrdered.appendChild(bucket);
    });

    // 초성 추출 함수
    function getTextInitial(char) {
      const code = char.charCodeAt(0);
      // 한글 음절: 가 ~ 힣 (U+AC00 ~ U+D7A3)
      if( code >= 0xAC00 && code <= 0xD7A3 ){
        const index = Math.floor((code - 0xAC00) / 588);
        return Chosong[index];
      }

      // 영문자: 대문자로 변환 후 첫 글자 반환
      if( /[a-zA-Z]/.test(char) ){
        return char.toUpperCase();
      }

      // 숫자나 기타 문자
      return '#';
    }

    //// 태그 개수
    document.getElementById('tagCount').innerText = tagBox.childElementCount +'개';
  </script>
</s_tag>
